# Use three different colors for the points (for "Rank changed a little", "Rank worsened", "Rank improved")
geom_point(aes(color = better_big_change)) +
# Add repelled labels. Only use data where big_change is TRUE. Fill them by the type of change (so they match the color in geom_point() above) and use white text
# Use two different colors for the filled labels, with no labels for the "Rank changed a little"
geom_label_repel(data = filter(co2_rankings, big_change == TRUE),
aes(label = country, fill = better_big_change),
color = "white") +
# Add notes about what the outliers mean in the bottom left and top right corners
# Make these are italicized and light grey. The text in the bottom corner is justified to the right with hjust = 1, and the text in the top corner is justified to the left with hjust = 0
annotate(geom = "text", x = 170, y = 6, label = "Outliers improving",
fontface = "italic", hjust = 1, color = "grey50") +
annotate(geom = "text", x = 2, y = 170, label = "Outliers worsening",
fontface = "italic", hjust = 0, color = "grey50") +
# Add mostly transparent rectangles in the bottom right and top left corners
# And, add text to define what the rectangles above actually mean
annotate(geom = "rect", xmin = 0, xmax = 25, ymin = 0, ymax = 25,
fill = "#2ECC40", alpha = 0.25) +
annotate(geom = "rect", xmin = 150, xmax = 175, ymin = 150, ymax = 175,
fill = "#FF851B", alpha = 0.25) +
annotate(geom = "text", x = 40, y = 6, label = "dinky\ndink",
hjust = 0, color = "#2ECC40") +
annotate(geom = "text", x = 165, y = 130, label = "poopy\npoop",
color = "#FF851B") +
# Add arrows between the text and the rectangles
# These should use the segment geom, and the arrows should be added with the arrow() function
annotate(geom = "segment", x = 38, xend = 20, y = 6, yend = 6, color = "#2ECC40",
arrow = arrow(angle = 15, length = unit(0.5, "lines"))) +
annotate(geom = "segment", x = 165, xend = 165, y = 135, yend = 155, color = "#FF851B",
arrow = arrow(angle = 15, length = unit(0.5, "lines"))) +
scale_color_manual(values = c('#0074D9', 'seagreen', '#FF4136')) +
scale_fill_manual(values = c('seagreen', '#FF4136')) +
# Make the x and y axes expand all the way to the edges of the plot area and add breaks every 25 units from 0 to 175
scale_x_continuous(expand = c(0, 0), breaks = seq(0, 175, 25)) +
scale_y_continuous(expand = c(0, 0), breaks = seq(0, 175, 25)) +
# Add labels for x-axis, y-axis, plot title, subtitle, and caption
labs(x = "1995 Rank",
y = "2014 Rank",
title = "Changes in CO<sub>2</sub> Emissions Rankings") +
guides(color = "none", fill = "none") +
theme_bw(base_family = "IBM Plex Sans", plot.title = element_markdown())
ggplot(co2_rankings, aes(x = rank_1995, y = rank_2014)) +
# Add a reference line that goes from the bottom corner to the top corner
annotate(geom = "segment", x = 0, xend = 175, y = 0, yend = 175, color = "darkgreen") +
geom_smooth(method = "lm", se = FALSE, color = "black", linewidth = 0.8) +
# Add points and color them by the type of change in rankings
# Use three different colors for the points (for "Rank changed a little", "Rank worsened", "Rank improved")
geom_point(aes(color = better_big_change)) +
# Add repelled labels. Only use data where big_change is TRUE. Fill them by the type of change (so they match the color in geom_point() above) and use white text
# Use two different colors for the filled labels, with no labels for the "Rank changed a little"
geom_label_repel(data = filter(co2_rankings, big_change == TRUE),
aes(label = country, fill = better_big_change),
color = "white") +
# Add notes about what the outliers mean in the bottom left and top right corners
# Make these are italicized and light grey. The text in the bottom corner is justified to the right with hjust = 1, and the text in the top corner is justified to the left with hjust = 0
annotate(geom = "text", x = 170, y = 6, label = "Outliers improving",
fontface = "italic", hjust = 1, color = "grey50") +
annotate(geom = "text", x = 2, y = 170, label = "Outliers worsening",
fontface = "italic", hjust = 0, color = "grey50") +
# Add mostly transparent rectangles in the bottom right and top left corners
# And, add text to define what the rectangles above actually mean
annotate(geom = "rect", xmin = 0, xmax = 25, ymin = 0, ymax = 25,
fill = "#2ECC40", alpha = 0.25) +
annotate(geom = "rect", xmin = 150, xmax = 175, ymin = 150, ymax = 175,
fill = "#FF851B", alpha = 0.25) +
annotate(geom = "text", x = 40, y = 6, label = "dinky\ndink",
hjust = 0, color = "#2ECC40") +
annotate(geom = "text", x = 165, y = 130, label = "poopy\npoop",
color = "#FF851B") +
# Add arrows between the text and the rectangles
# These should use the segment geom, and the arrows should be added with the arrow() function
annotate(geom = "segment", x = 38, xend = 20, y = 6, yend = 6, color = "#2ECC40",
arrow = arrow(angle = 15, length = unit(0.5, "lines"))) +
annotate(geom = "segment", x = 165, xend = 165, y = 135, yend = 155, color = "#FF851B",
arrow = arrow(angle = 15, length = unit(0.5, "lines"))) +
scale_color_manual(values = c('#0074D9', 'seagreen', '#FF4136')) +
scale_fill_manual(values = c('seagreen', '#FF4136')) +
# Make the x and y axes expand all the way to the edges of the plot area and add breaks every 25 units from 0 to 175
scale_x_continuous(expand = c(0, 0), breaks = seq(0, 175, 25)) +
scale_y_continuous(expand = c(0, 0), breaks = seq(0, 175, 25)) +
# Add labels for x-axis, y-axis, plot title, subtitle, and caption
labs(x = "1995 Rank",
y = "2014 Rank",
title = "Changes in CO<sub>2</sub> Emissions Rankings") +
guides(color = "none", fill = "none") +
theme_bw(base_family = "IBM Plex Sans") +
theme(plot.title = element_markdown())
ggplot(co2_rankings, aes(x = rank_1995, y = rank_2014)) +
# Add a reference line that goes from the bottom corner to the top corner
annotate(geom = "segment", x = 0, xend = 175, y = 0, yend = 175, color = "darkgreen") +
geom_smooth(method = "lm", se = FALSE, color = "black", linewidth = 0.8) +
# Add points and color them by the type of change in rankings
# Use three different colors for the points (for "Rank changed a little", "Rank worsened", "Rank improved")
geom_point(aes(color = better_big_change)) +
# Add repelled labels. Only use data where big_change is TRUE. Fill them by the type of change (so they match the color in geom_point() above) and use white text
# Use two different colors for the filled labels, with no labels for the "Rank changed a little"
geom_label_repel(data = filter(co2_rankings, big_change == TRUE),
aes(label = country, fill = better_big_change),
color = "white") +
# Add notes about what the outliers mean in the bottom left and top right corners
# Make these are italicized and light grey. The text in the bottom corner is justified to the right with hjust = 1, and the text in the top corner is justified to the left with hjust = 0
annotate(geom = "text", x = 170, y = 6, label = "Outliers improving",
fontface = "italic", hjust = 1, color = "grey50") +
annotate(geom = "text", x = 2, y = 170, label = "Outliers worsening",
fontface = "italic", hjust = 0, color = "grey50") +
# Add mostly transparent rectangles in the bottom right and top left corners
# And, add text to define what the rectangles above actually mean
annotate(geom = "rect", xmin = 0, xmax = 25, ymin = 0, ymax = 25,
fill = "#2ECC40", alpha = 0.25) +
annotate(geom = "rect", xmin = 150, xmax = 175, ymin = 150, ymax = 175,
fill = "#FF851B", alpha = 0.25) +
annotate(geom = "text", x = 40, y = 6, label = "dinky\ndink",
hjust = 0, color = "#2ECC40") +
annotate(geom = "text", x = 165, y = 130, label = "poopy\npoop",
color = "#FF851B") +
# Add arrows between the text and the rectangles
# These should use the segment geom, and the arrows should be added with the arrow() function
annotate(geom = "segment", x = 38, xend = 20, y = 6, yend = 6, color = "#2ECC40",
arrow = arrow(angle = 15, length = unit(0.5, "lines"))) +
annotate(geom = "segment", x = 165, xend = 165, y = 135, yend = 155, color = "#FF851B",
arrow = arrow(angle = 15, length = unit(0.5, "lines"))) +
scale_color_manual(values = c('#0074D9', 'seagreen', '#FF4136')) +
scale_fill_manual(values = c('seagreen', '#FF4136')) +
# Make the x and y axes expand all the way to the edges of the plot area and add breaks every 25 units from 0 to 175
scale_x_continuous(expand = c(0, 0), breaks = seq(0, 175, 25)) +
scale_y_continuous(expand = c(0, 0), breaks = seq(0, 175, 25)) +
# Add labels for x-axis, y-axis, plot title, subtitle, and caption
labs(x = "1995 Rank",
y = "2014 Rank",
title = "Changes in CO<sub>2</sub> Emissions Rankings",
subtitle = "Countries that <span style= 'color: seagreen'> **improved**  </span>") +
guides(color = "none", fill = "none") +
theme_bw(base_family = "IBM Plex Sans") +
theme(plot.title = element_markdown(face = "bold", size = rel(1.6)),
plot.subtitle = element_markdown(size = rel(1.3)),
plot.margin = unit(c(0.5, 1, 0.5, 0.5), units = "lines"))
ggplot(co2_rankings, aes(x = rank_1995, y = rank_2014)) +
# Add a reference line that goes from the bottom corner to the top corner
annotate(geom = "segment", x = 0, xend = 175, y = 0, yend = 175, color = "darkgreen") +
geom_smooth(method = "lm", se = FALSE, color = "black", linewidth = 0.8) +
# Add points and color them by the type of change in rankings
# Use three different colors for the points (for "Rank changed a little", "Rank worsened", "Rank improved")
geom_point(aes(color = better_big_change)) +
# Add repelled labels. Only use data where big_change is TRUE. Fill them by the type of change (so they match the color in geom_point() above) and use white text
# Use two different colors for the filled labels, with no labels for the "Rank changed a little"
geom_label_repel(data = filter(co2_rankings, big_change == TRUE),
aes(label = country, fill = better_big_change),
color = "white") +
# Add notes about what the outliers mean in the bottom left and top right corners
# Make these are italicized and light grey. The text in the bottom corner is justified to the right with hjust = 1, and the text in the top corner is justified to the left with hjust = 0
annotate(geom = "text", x = 170, y = 6, label = "Outliers improving",
fontface = "italic", hjust = 1, color = "grey50") +
annotate(geom = "text", x = 2, y = 170, label = "Outliers worsening",
fontface = "italic", hjust = 0, color = "grey50") +
# Add mostly transparent rectangles in the bottom right and top left corners
# And, add text to define what the rectangles above actually mean
annotate(geom = "rect", xmin = 0, xmax = 25, ymin = 0, ymax = 25,
fill = "#2ECC40", alpha = 0.25) +
annotate(geom = "rect", xmin = 150, xmax = 175, ymin = 150, ymax = 175,
fill = "#FF851B", alpha = 0.25) +
annotate(geom = "text", x = 40, y = 6, label = "dinky\ndink",
hjust = 0, color = "#2ECC40") +
annotate(geom = "text", x = 165, y = 130, label = "poopy\npoop",
color = "#FF851B") +
# Add arrows between the text and the rectangles
# These should use the segment geom, and the arrows should be added with the arrow() function
annotate(geom = "segment", x = 38, xend = 20, y = 6, yend = 6, color = "#2ECC40",
arrow = arrow(angle = 15, length = unit(0.5, "lines"))) +
annotate(geom = "segment", x = 165, xend = 165, y = 135, yend = 155, color = "#FF851B",
arrow = arrow(angle = 15, length = unit(0.5, "lines"))) +
scale_color_manual(values = c('#0074D9', 'seagreen', '#FF4136')) +
scale_fill_manual(values = c('seagreen', '#FF4136')) +
# Make the x and y axes expand all the way to the edges of the plot area and add breaks every 25 units from 0 to 175
scale_x_continuous(expand = c(0, 0), breaks = seq(0, 175, 25)) +
scale_y_continuous(expand = c(0, 0), breaks = seq(0, 175, 25)) +
# Add labels for x-axis, y-axis, plot title, subtitle, and caption
labs(x = "1995 Rank",
y = "2014 Rank",
title = "Changes in CO<sub>2</sub> Emissions Rankings",
subtitle = "Countries that <span style= 'color: seagreen'>**improved**</span> or
<span style= 'color: #FF4136'> **worsened** </span> more than 25 positions
in the rankings highlighted") +
guides(color = "none", fill = "none") +
theme_bw(base_family = "IBM Plex Sans") +
theme(plot.title = element_markdown(face = "bold", size = rel(1.6)),
plot.subtitle = element_markdown(size = rel(1.3)),
plot.margin = unit(c(0.5, 1, 0.5, 0.5), units = "lines"))
ggplot(co2_rankings, aes(x = rank_1995, y = rank_2014)) +
# Add a reference line that goes from the bottom corner to the top corner
annotate(geom = "segment", x = 0, xend = 175, y = 0, yend = 175, color = "darkgreen") +
geom_smooth(method = "lm", se = FALSE, color = "black", linewidth = 0.8) +
# Add points and color them by the type of change in rankings
# Use three different colors for the points (for "Rank changed a little", "Rank worsened", "Rank improved")
geom_point(aes(color = better_big_change)) +
# Add repelled labels. Only use data where big_change is TRUE. Fill them by the type of change (so they match the color in geom_point() above) and use white text
# Use two different colors for the filled labels, with no labels for the "Rank changed a little"
geom_label_repel(data = filter(co2_rankings, big_change == TRUE),
aes(label = country, fill = better_big_change),
color = "white") +
# Add notes about what the outliers mean in the bottom left and top right corners
# Make these are italicized and light grey. The text in the bottom corner is justified to the right with hjust = 1, and the text in the top corner is justified to the left with hjust = 0
annotate(geom = "text", x = 170, y = 6, label = "Outliers improving",
fontface = "italic", hjust = 1, color = "grey50") +
annotate(geom = "text", x = 2, y = 170, label = "Outliers worsening",
fontface = "italic", hjust = 0, color = "grey50") +
# Add mostly transparent rectangles in the bottom right and top left corners
# And, add text to define what the rectangles above actually mean
annotate(geom = "rect", xmin = 0, xmax = 25, ymin = 0, ymax = 25,
fill = "#2ECC40", alpha = 0.25) +
annotate(geom = "rect", xmin = 150, xmax = 175, ymin = 150, ymax = 175,
fill = "#FF851B", alpha = 0.25) +
annotate(geom = "text", x = 40, y = 6, label = "dinky\ndink",
hjust = 0, color = "#2ECC40") +
annotate(geom = "text", x = 165, y = 130, label = "poopy\npoop",
color = "#FF851B") +
# Add arrows between the text and the rectangles
# These should use the segment geom, and the arrows should be added with the arrow() function
annotate(geom = "segment", x = 38, xend = 20, y = 6, yend = 6, color = "#2ECC40",
arrow = arrow(angle = 15, length = unit(0.5, "lines"))) +
annotate(geom = "segment", x = 165, xend = 165, y = 135, yend = 155, color = "#FF851B",
arrow = arrow(angle = 15, length = unit(0.5, "lines"))) +
scale_color_manual(values = c('#0074D9', 'seagreen', '#FF4136')) +
scale_fill_manual(values = c('seagreen', '#FF4136')) +
# Make the x and y axes expand all the way to the edges of the plot area and add breaks every 25 units from 0 to 175
scale_x_continuous(expand = c(0, 0), breaks = seq(0, 175, 25)) +
scale_y_continuous(expand = c(0, 0), breaks = seq(0, 175, 25)) +
# Add labels for x-axis, y-axis, plot title, subtitle, and caption
labs(x = "1995 Rank",
y = "2014 Rank",
title = "Changes in CO<sub>2</sub> Emissions Rankings",
subtitle = "Countries that <span style= 'color: seagreen'>**improved**</span> or
<span style= 'color: #FF4136'> **worsened** </span> more than 25 positions
in the rankings highlighted") +
guides(color = "none", fill = "none") +
theme_bw(base_family = "IBM Plex Sans") +
theme(plot.title = element_markdown(face = "bold", size = rel(1)),
plot.subtitle = element_markdown(size = rel(1.3)),
plot.margin = unit(c(0.5, 1, 0.5, 0.5), units = "lines"))
ggplot(co2_rankings, aes(x = rank_1995, y = rank_2014)) +
# Add a reference line that goes from the bottom corner to the top corner
annotate(geom = "segment", x = 0, xend = 175, y = 0, yend = 175, color = "darkgreen") +
geom_smooth(method = "lm", se = FALSE, color = "black", linewidth = 0.8) +
# Add points and color them by the type of change in rankings
# Use three different colors for the points (for "Rank changed a little", "Rank worsened", "Rank improved")
geom_point(aes(color = better_big_change)) +
# Add repelled labels. Only use data where big_change is TRUE. Fill them by the type of change (so they match the color in geom_point() above) and use white text
# Use two different colors for the filled labels, with no labels for the "Rank changed a little"
geom_label_repel(data = filter(co2_rankings, big_change == TRUE),
aes(label = country, fill = better_big_change),
color = "white") +
# Add notes about what the outliers mean in the bottom left and top right corners
# Make these are italicized and light grey. The text in the bottom corner is justified to the right with hjust = 1, and the text in the top corner is justified to the left with hjust = 0
annotate(geom = "text", x = 170, y = 6, label = "Outliers improving",
fontface = "italic", hjust = 1, color = "grey50") +
annotate(geom = "text", x = 2, y = 170, label = "Outliers worsening",
fontface = "italic", hjust = 0, color = "grey50") +
# Add mostly transparent rectangles in the bottom right and top left corners
# And, add text to define what the rectangles above actually mean
annotate(geom = "rect", xmin = 0, xmax = 25, ymin = 0, ymax = 25,
fill = "#2ECC40", alpha = 0.25) +
annotate(geom = "rect", xmin = 150, xmax = 175, ymin = 150, ymax = 175,
fill = "#FF851B", alpha = 0.25) +
annotate(geom = "text", x = 40, y = 6, label = "dinky\ndink",
hjust = 0, color = "#2ECC40") +
annotate(geom = "text", x = 165, y = 130, label = "poopy\npoop",
color = "#FF851B") +
# Add arrows between the text and the rectangles
# These should use the segment geom, and the arrows should be added with the arrow() function
annotate(geom = "segment", x = 38, xend = 20, y = 6, yend = 6, color = "#2ECC40",
arrow = arrow(angle = 15, length = unit(0.5, "lines"))) +
annotate(geom = "segment", x = 165, xend = 165, y = 135, yend = 155, color = "#FF851B",
arrow = arrow(angle = 15, length = unit(0.5, "lines"))) +
scale_color_manual(values = c('#0074D9', 'seagreen', '#FF4136')) +
scale_fill_manual(values = c('seagreen', '#FF4136')) +
# Make the x and y axes expand all the way to the edges of the plot area and add breaks every 25 units from 0 to 175
scale_x_continuous(expand = c(0, 0), breaks = seq(0, 175, 25)) +
scale_y_continuous(expand = c(0, 0), breaks = seq(0, 175, 25)) +
# Add labels for x-axis, y-axis, plot title, subtitle, and caption
labs(x = "1995 Rank",
y = "2014 Rank",
title = "Changes in CO<sub>2</sub> Emissions Rankings",
subtitle = "Countries that <span style= 'color: seagreen'>**improved**</span> or
<span style= 'color: #FF4136'> **worsened** </span> more than 25 positions
in the rankings highlighted") +
guides(color = "none", fill = "none") +
theme_bw(base_family = "IBM Plex Sans") +
theme(plot.title = element_markdown(face = "bold", size = rel(1.6)),
plot.subtitle = element_markdown(size = rel(1.3)),
plot.margin = unit(c(0.5, 1, 0.5, 0.5), units = "lines"))
source("~/Desktop/Programs/Git/DataViz_2026/tutorials/Week 4/tutorial04_SVU.R")
ggplot(co2_rankings, aes(x = rank_1995, y = rank_2014)) +
# Add a reference line that goes from the bottom corner to the top corner
annotate(geom = "segment", x = 0, xend = 175, y = 0, yend = 175, color = "darkgreen") +
geom_smooth(method = "lm", se = FALSE, color = "black", linewidth = 0.8) +
# Add points and color them by the type of change in rankings
# Use three different colors for the points (for "Rank changed a little", "Rank worsened", "Rank improved")
geom_point(aes(color = better_big_change)) +
# Add repelled labels. Only use data where big_change is TRUE. Fill them by the type of change (so they match the color in geom_point() above) and use white text
# Use two different colors for the filled labels, with no labels for the "Rank changed a little"
geom_label_repel(data = filter(co2_rankings, big_change == TRUE),
aes(label = country, fill = better_big_change),
color = "white") +
# Add notes about what the outliers mean in the bottom left and top right corners
# Make these are italicized and light grey. The text in the bottom corner is justified to the right with hjust = 1, and the text in the top corner is justified to the left with hjust = 0
annotate(geom = "text", x = 170, y = 6, label = "Outliers improving",
fontface = "italic", hjust = 1, color = "grey50") +
annotate(geom = "text", x = 2, y = 170, label = "Outliers worsening",
fontface = "italic", hjust = 0, color = "grey50") +
# Add mostly transparent rectangles in the bottom right and top left corners
# And, add text to define what the rectangles above actually mean
annotate(geom = "rect", xmin = 0, xmax = 25, ymin = 0, ymax = 25,
fill = "#2ECC40", alpha = 0.25) +
annotate(geom = "rect", xmin = 150, xmax = 175, ymin = 150, ymax = 175,
fill = "#FF851B", alpha = 0.25) +
annotate(geom = "text", x = 40, y = 6, label = "dinky\ndink",
hjust = 0, color = "#2ECC40") +
annotate(geom = "text", x = 165, y = 130, label = "poopy\npoop",
color = "#FF851B") +
# Add arrows between the text and the rectangles
# These should use the segment geom, and the arrows should be added with the arrow() function
annotate(geom = "segment", x = 38, xend = 20, y = 6, yend = 6, color = "#2ECC40",
arrow = arrow(angle = 15, length = unit(0.5, "lines"))) +
annotate(geom = "segment", x = 165, xend = 165, y = 135, yend = 155, color = "#FF851B",
arrow = arrow(angle = 15, length = unit(0.5, "lines"))) +
scale_color_manual(values = c('#0074D9', 'seagreen', '#FF4136')) +
scale_fill_manual(values = c('seagreen', '#FF4136')) +
# Make the x and y axes expand all the way to the edges of the plot area and add breaks every 25 units from 0 to 175
scale_x_continuous(expand = c(0, 0), breaks = seq(0, 175, 25)) +
scale_y_continuous(expand = c(0, 0), breaks = seq(0, 175, 25)) +
# Add labels for x-axis, y-axis, plot title, subtitle, and caption
labs(x = "1995 Rank",
y = "2014 Rank",
title = "Changes in CO<sub>2</sub> Emissions Rankings",
subtitle = "Countries that <span style= 'color: seagreen'>**improved**</span> or
<span style= 'color: #FF4136'> **worsened** </span> more than 25 positions
in the rankings highlighted") +
guides(color = "none", fill = "none") +
theme_bw(base_family = "IBM Plex Sans") +
theme(plot.title = element_markdown(face = "bold", size = rel(1.6)),
plot.subtitle = element_markdown(size = rel(1.3)),
plot.margin = unit(c(0.5, 1, 0.5, 0.5), units = "lines"))
# Import dataset
CHES <- read.csv("https://raw.githubusercontent.com/ASDS-TCD/DataViz_2026/refs/heads/main/datasets/1999-2024_CHES.csv")
# subset to only years 2010, 2014, 2019
CHES_subset <- CHES |> filter(year<2024 & year>2008)
# change level labels for govt variable
CHES_subset$govt <- as.factor(CHES_subset$govt)
levels(CHES_subset$govt) <- c("Party not in government","In government for part of year","Party in government full year")
# create base plot
base_plot <- ggplot(data=CHES_subset, aes(x=vote, y=lrgen,  color=as.factor(govt))) +
geom_point() + facet_wrap(vars(year)) +
labs(y="Left-right placement", x="Vote share (%)", color="Part of government")
base_plot
dev.off()
CHES_subset$
pdf("CHES_minimal.pdf")
base_plot +
theme_minimal() +
theme(panel.grid.minor = element_blank())
base_plot <- base_plot +
labs(title = "CHES Party Positions",
subtitle = "2010 - 2019",
caption = "Source: CHES Chapel Hill Expert Survey") +
theme_minimal(base_family = "Roboto Condensed", base_size = 12) +
theme(panel.grid.minor = element_blank(),
# Bold, bigger title
plot.title = element_text(face = "bold", size = rel(1.7)),
# Plain, slightly bigger subtitle that is grey
plot.subtitle = element_text(face = "plain", size = rel(1.3), color = "black"),
# Italic, smaller, grey caption that is left-aligned
plot.caption = element_text(face = "italic", size = rel(0.7), color = "black", hjust = 0),
# Bold legend titles
legend.title = element_text(face = "bold"))
base_plot
base_plot <- base_plot + theme(
# Bold, slightly larger facet titles that are left-aligned for the sake of repetition
strip.text = element_text(face = "bold", size = rel(1.1), hjust = 0),
# Bold axis titles
axis.title = element_text(face = "bold"),
# Add some space above the x-axis title and make it left-aligned
axis.title.x = element_text(margin = margin(t = 10), hjust = 0),
# Add some space to the right of the y-axis title and make it top-aligned
axis.title.y = element_text(margin = margin(r = 10), hjust = 1))
# Add a light grey background to the facet titles, with no borders
base_plot <- base_plot + theme(strip.background = element_rect(fill = "grey90", color = NA),
# Add a thin grey border around all the plots to tie in the facet titles
panel.border = element_rect(color = "grey90", fill = NA))
base_plot
# subset to only Conservative parties
CHES_family <- CHES |> filter(family==1 | family==2 | family==4)
# change level labels for party family variable
CHES_family$family <- as.factor(CHES_family$family)
levels(CHES_family$family) <- c("Radical Right","Conservatives","Christian-Democratic")
CHES_family$country_name <- as.factor(CHES_family$country)
levels(CHES_family$country_name) <- c("BE", "DK", "GE", "GR", "ESP", "FR", "IRL", "IT", "NL", "UK", "POR", "AUS", "FIN", "SV", "BUL", "CZ", "EST", "HUN", "LAT", "LITH", "POL", "ROM", "SLO", "SLE", "CRO", "MAL", "LUX", "CYP")
# subset data to the indicators we care about
indicators <- c(population = "SP.POP.TOTL",  # Population
co2_emissions = "EN.GHG.ALL.MT.CE.AR5",  # CO2 emissions
gdp_per_cap = "NY.GDP.PCAP.KD")  # GDP per capita
# download data from WDI package
wdi_co2 <- WDI(country = "all", indicators, extra = TRUE,
start = 1995, end = 2015)
# clean the data by removing non-country countries
wdi_co2 <- wdi_co2 |>
filter(region != "Aggregates")
# I'll do most of the data wrangling for you here:
co2_rankings <- wdi_co2 |>
# Get rid of smaller countries
filter(population > 200000) |>
# Only look at two years
filter(year %in% c(1995, 2014)) |>
# Get rid of all the rows that have missing values in co2_emissions
drop_na(co2_emissions) |>
# Look at each year individually and rank countries based on their emissions that year
group_by(year) |>
mutate(ranking = rank(co2_emissions)) |>
ungroup() |>
# Only select a handful of columns, mostly just the newly created "ranking"
# column and some country identifiers
select(iso3c, country, year, region, income, ranking) |>
# Right now the data is tidy and long, but we want to widen it and create
# separate columns for emissions in 1995 and in 2014. pivot_wider() will make
# new columns based on the existing "year" column (that's what `names_from`
# does), and it will add "rank_" as the prefix, so that the new columns will
# be "rank_1995" and "rank_2014". The values that go in those new columns will
# come from the existing "ranking" column
pivot_wider(names_from = year, names_prefix = "rank_", values_from = ranking) |>
# Find the difference in ranking between 2014 and 1995
mutate(rank_diff = rank_2014 - rank_1995) |>
# Remove all rows where there's a missing value in the rank_diff column
drop_na(rank_diff) |>
# Make an indicator variable that is true of the absolute value of the
# difference in rankings is greater than 25. 25 is arbitrary hereâ€”that just
# felt like a big change in rankings
mutate(big_change = ifelse(abs(rank_diff) >= 25, TRUE, FALSE)) |>
# Make another indicator variable that indicates if the rank improved by a
# lot, worsened by a lot, or didn't change much. We use the case_when()
# function, which is like a fancy version of ifelse() that takes multiple
# conditions. This is how it generally works:
#
# case_when(
#  some_test ~ value_if_true,
#  some_other_test ~ value_if_true,
#  TRUE ~ value_otherwise
#)
mutate(better_big_change = case_when(
rank_diff <= -25 ~ "Rank improved",
rank_diff >= 25 ~ "Rank worsened",
TRUE ~ "Rank changed a little"
))
### Visualizations
glimpse(co2_rankings)
# These three functions make it so all geoms that use text, label, and label_repel
# We'll use IBM Plex Sans as the font.
# Those layers are *not* influenced by whatever you include in the base_family argument in something like theme_bw(),
# So ordinarily you'd need to specify the font in each individual annotate(geom = "text") layer or geom_label() layer, and that's tedious
# This removes that tediousness
update_geom_defaults("text", list(family = "IBM Plex Sans"))
update_geom_defaults("label", list(family = "IBM Plex Sans"))
update_geom_defaults("label_repel", list(family = "IBM Plex Sans"))
# Plot the CO2 rankings with rank_1995 along the x-axis, and rank_2014 along the y-axis
length(co2_rankings$rank_1995)
ggplot(co2_rankings, aes(x = rank_1995, y = rank_2014)) +
# Add a reference line that goes from the bottom corner to the top corner
annotate(geom = "segment", x = 0, xend = 175, y = 0, yend = 175, color = "darkgreen") +
geom_smooth(method = "lm", se = FALSE, color = "black", linewidth = 0.8) +
# Add points and color them by the type of change in rankings
# Use three different colors for the points (for "Rank changed a little", "Rank worsened", "Rank improved")
geom_point(aes(color = better_big_change)) +
# Add repelled labels. Only use data where big_change is TRUE. Fill them by the type of change (so they match the color in geom_point() above) and use white text
# Use two different colors for the filled labels, with no labels for the "Rank changed a little"
geom_label_repel(data = filter(co2_rankings, big_change == TRUE),
aes(label = country, fill = better_big_change),
color = "white") +
# Add notes about what the outliers mean in the bottom left and top right corners
# Make these are italicized and light grey. The text in the bottom corner is justified to the right with hjust = 1, and the text in the top corner is justified to the left with hjust = 0
annotate(geom = "text", x = 170, y = 6, label = "Outliers improving",
fontface = "italic", hjust = 1, color = "grey50") +
annotate(geom = "text", x = 2, y = 170, label = "Outliers worsening",
fontface = "italic", hjust = 0, color = "grey50") +
# Add mostly transparent rectangles in the bottom right and top left corners
# And, add text to define what the rectangles above actually mean
annotate(geom = "rect", xmin = 0, xmax = 25, ymin = 0, ymax = 25,
fill = "#2ECC40", alpha = 0.25) +
annotate(geom = "rect", xmin = 150, xmax = 175, ymin = 150, ymax = 175,
fill = "#FF851B", alpha = 0.25) +
annotate(geom = "text", x = 40, y = 6, label = "dinky\ndink",
hjust = 0, color = "#2ECC40") +
annotate(geom = "text", x = 165, y = 130, label = "poopy\npoop",
color = "#FF851B") +
# Add arrows between the text and the rectangles
# These should use the segment geom, and the arrows should be added with the arrow() function
annotate(geom = "segment", x = 38, xend = 20, y = 6, yend = 6, color = "#2ECC40",
arrow = arrow(angle = 15, length = unit(0.5, "lines"))) +
annotate(geom = "segment", x = 165, xend = 165, y = 135, yend = 155, color = "#FF851B",
arrow = arrow(angle = 15, length = unit(0.5, "lines"))) +
scale_color_manual(values = c('#0074D9', 'seagreen', '#FF4136')) +
scale_fill_manual(values = c('seagreen', '#FF4136')) +
# Make the x and y axes expand all the way to the edges of the plot area and add breaks every 25 units from 0 to 175
scale_x_continuous(expand = c(0, 0), breaks = seq(0, 175, 25)) +
scale_y_continuous(expand = c(0, 0), breaks = seq(0, 175, 25)) +
# Add labels for x-axis, y-axis, plot title, subtitle, and caption
labs(x = "1995 Rank",
y = "2014 Rank",
title = "Changes in CO<sub>2</sub> Emissions Rankings",
subtitle = "Countries that <span style= 'color: seagreen'>**improved**</span> or
<span style= 'color: #FF4136'> **worsened** </span> more than 25 positions
in the rankings highlighted") +
guides(color = "none", fill = "none") +
theme_bw(base_family = "IBM Plex Sans") +
theme(plot.title = element_markdown(face = "bold", size = rel(1.6)),
plot.subtitle = element_markdown(size = rel(1.3)),
plot.margin = unit(c(0.5, 1, 0.5, 0.5), units = "lines"))
